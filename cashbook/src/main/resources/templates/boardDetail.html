<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>BoardDetail</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script>
let modifyBtn0Prevent = function(){
	$('#modifyBtn0').on('click');
	$('#modifyBtn1').on('click');
	$('#modifyBtn2').on('click');
	$('#modifyBtn3').on('click');
	$('#modifyBtn4').on('click');
}
$(document).ready(function(){
	$('#commentAddBtn').click(function(){
		if($('#commentContent').val().length === 0) {
			alert("댓글을 입력하세요");
		} else {
			$('#commentForm').submit();
		}
	});
	
	// 수정 버튼
	$('#modifyBtn0').click(function(){
		$('#modifyBtn1').off('click');
		$('#modifyBtn2').off('click');
		$('#modifyBtn3').off('click');
		$('#modifyBtn4').off('click');
		let content = $('#commentContentText0').text();
		console.log(content);
		let cNo = $('#commentNoText0').text();
		console.log(cNo);
		let bNo = $('#boardNoVal').val();
		console.log(bNo);
		$('#commentContentText0').html(
				"<input type='hidden' name='commentNo' value='"+cNo+"' id='modifyCommentNo'>"
				+"<input type='hidden' name='boardNo' value='"+bNo+"' id='modifyBoardNo'>"
				+"<input type='text' id='modifyCommentContent' name='commentContent' value='"+content+"'>");
		$('#modify-div0').html("<button type='button' class='commentBtn' id='modifySubmitBtn'>수정</button>");
		$('#modifySubmitBtn').click(function(){
			if($('#modifyCommentContent').val().length === 0) {
				alert("댓글을 입력하세요");
			} else {
				$.ajax({
					type: "POST",
					url: "/cashbook/modifyComment",
					data: {
						"commentNo" : $('#modifyCommentNo').val(),
						"boardNo" : $('#modifyBoardNo').val(),
						"commentContent" : $('#modifyCommentContent').val()
					},
					success: function() {
						alert('댓글 수정 성공');
						location.reload();
					}, error: function() {
						alert('댓글 수정 실패')
					}
				});
			}
		});
		modifyBtnInit();
	});

	$('#modifyBtn1').click(function(){
		$('#modifyBtn0').off('click');
		$('#modifyBtn2').off('click');
		$('#modifyBtn3').off('click');
		$('#modifyBtn4').off('click');
		let content = $('#commentContentText1').text();
		console.log(content);
		let cNo = $('#commentNoText1').text();
		console.log(cNo);
		let bNo = $('#boardNoVal').val();
		console.log(bNo);
		$('#commentContentText1').html(
				"<input type='hidden' name='commentNo' value='"+cNo+"' id='modifyCommentNo'>"
				+"<input type='hidden' name='boardNo' value='"+bNo+"' id='modifyBoardNo'>"
				+"<input type='text' id='modifyCommentContent' name='commentContent' value='"+content+"'>");
		$('#modify-div1').html("<button type='button' class='commentBtn' id='modifySubmitBtn'>수정</button>");
		$('#modifySubmitBtn').click(function(){
		if($('#modifyCommentContent').val().length === 0) {
				alert("댓글을 입력하세요");
			} else {
				$.ajax({
					type: "POST",
					url: "/cashbook/modifyComment",
					data: {
						"commentNo" : $('#modifyCommentNo').val(),
						"boardNo" : $('#modifyBoardNo').val(),
						"commentContent" : $('#modifyCommentContent').val()
					},
					success: function() {
						alert('댓글 수정 성공');
						location.reload();
					}, error: function() {
						alert('댓글 수정 실패')
					}
				});
			}
		});
		modifyBtn0Prevent();
	});
	
	$('#modifyBtn2').click(function(){
		$('#modifyBtn0').off('click');
		$('#modifyBtn1').off('click');
		$('#modifyBtn3').off('click');
		$('#modifyBtn4').off('click');
		let content = $('#commentContentText2').text();
		console.log(content);
		let cNo = $('#commentNoText2').text();
		console.log(cNo);
		let bNo = $('#boardNoVal').val();
		console.log(bNo);
		$('#commentContentText2').html(
				"<input type='hidden' name='commentNo' value='"+cNo+"' id='modifyCommentNo'>"
				+"<input type='hidden' name='boardNo' value='"+bNo+"' id='modifyBoardNo'>"
				+"<input type='text' id='modifyCommentContent' name='commentContent' value='"+content+"'>");
		$('#modify-div2').html("<button type='button' class='commentBtn' id='modifySubmitBtn'>수정</button>");
		$('#modifySubmitBtn').click(function(){
		if($('#modifyCommentContent').val().length === 0) {
				alert("댓글을 입력하세요");
			} else {
				$.ajax({
					type: "POST",
					url: "/cashbook/modifyComment",
					data: {
						"commentNo" : $('#modifyCommentNo').val(),
						"boardNo" : $('#modifyBoardNo').val(),
						"commentContent" : $('#modifyCommentContent').val()
					},
					success: function() {
						alert('댓글 수정 성공');
						location.reload();
					}, error: function() {
						alert('댓글 수정 실패')
					}
				});
			}
		});
		modifyBtn0Prevent();
	});

	$('#modifyBtn3').click(function(){
		$('#modifyBtn0').off('click');
		$('#modifyBtn1').off('click');
		$('#modifyBtn2').off('click');
		$('#modifyBtn4').off('click');
		let content = $('#commentContentText3').text();
		console.log(content);
		let cNo = $('#commentNoText3').text();
		console.log(cNo);
		let bNo = $('#boardNoVal').val();
		console.log(bNo);
		$('#commentContentText3').html(
				"<input type='hidden' name='commentNo' value='"+cNo+"' id='modifyCommentNo'>"
				+"<input type='hidden' name='boardNo' value='"+bNo+"' id='modifyBoardNo'>"
				+"<input type='text' id='modifyCommentContent' name='commentContent' value='"+content+"'>");
		$('#modify-div3').html("<button type='button' class='commentBtn' id='modifySubmitBtn'>수정</button>");
		$('#modifySubmitBtn').click(function(){
		if($('#modifyCommentContent').val().length === 0) {
				alert("댓글을 입력하세요");
			} else {
				$.ajax({
					type: "POST",
					url: "/cashbook/modifyComment",
					data: {
						"commentNo" : $('#modifyCommentNo').val(),
						"boardNo" : $('#modifyBoardNo').val(),
						"commentContent" : $('#modifyCommentContent').val()
					},
					success: function() {
						alert('댓글 수정 성공');
						location.reload();
					}, error: function() {
						alert('댓글 수정 실패')
					}
				});
			}
		});
		modifyBtn0Prevent();
	});

	$('#modifyBtn4').click(function(){
		$('#modifyBtn0').off('click');
		$('#modifyBtn1').off('click');
		$('#modifyBtn2').off('click');
		$('#modifyBtn3').off('click');
		let content = $('#commentContentText4').text();
		console.log(content);
		let cNo = $('#commentNoText4').text();
		console.log(cNo);
		let bNo = $('#boardNoVal').val();
		console.log(bNo);
		$('#commentContentText4').html(
				"<input type='hidden' name='commentNo' value='"+cNo+"' id='modifyCommentNo'>"
				+"<input type='hidden' name='boardNo' value='"+bNo+"' id='modifyBoardNo'>"
				+"<input type='text' id='modifyCommentContent' name='commentContent' value='"+content+"'>");
		$('#modify-div4').html("<button type='button' class='commentBtn' id='modifySubmitBtn'>수정</button>");
		$('#modifySubmitBtn').click(function(){
		if($('#modifyCommentContent').val().length === 0) {
				alert("댓글을 입력하세요");
			} else {
				$.ajax({
					type: "POST",
					url: "/cashbook/modifyComment",
					data: {
						"commentNo" : $('#modifyCommentNo').val(),
						"boardNo" : $('#modifyBoardNo').val(),
						"commentContent" : $('#modifyCommentContent').val()
					},
					success: function() {
						alert('댓글 수정 성공');
						location.reload();
					}, error: function() {
						alert('댓글 수정 실패')
					}
				});
			}
		});
		modifyBtn0Prevent();
	});
});
</script>
<style>
.sidenav {
	height: 100%;
	width: 250px;
	text-align: center;
	position: fixed;
	z-index: 1;
	top: 0;
	left: 0;
	background-color: #3498db;
	overflow-x: hidden;
	padding-top: 20px;
}

.info {
	margin: 30px;
}

#sidePic {
	width: 80px;
	height: 80px;
	border-radius: 3em;
	margin-bottom: 5px;
}

.menuItem {
	margin-bottom: 50px;
	text-decoration: none;
	font-size: 25px;
	color: #111;
	display: block;
	border: none;
	background-color: #3498db;
	cursor: pointer;
	outline: none;
}

.dropdown-btn {
 	margin-bottom: 50px;
 	margin-left: 50px;
	text-decoration: none;
	font-size: 25px;
	color: #111;
	display: block;
	border: none;
	background-color: #3498db;
	cursor: pointer;
	outline: none;
}

.menuItem:hover, .dropdown-btn:hover {
	color: #f1f1f1;
}

h1 {
	margin: 50px;
}

.main {
	margin-left: 200px; /* Same as the width of the sidenav */
	margin-top: 100px;
	width: 1000px;
}

.main-contents {
	width: 1000px;
	margin-left: 200px;
}

.title {
	text-align: center;
}

.nextBtn {
	text-align: right;
}

.navBtn {
	background-color: #e6e6e6;
	width: 100px;
	border-radius: 20em;
}

.boardBox {
	margin-bottom: 25px;
}

.content {
	font-size: 20px;
	margin-top: 50px;
}

.border-div {
	margin-top: 20px;
	padding: 10px;
	border: 1px solid #ccc;
	border-radius: 0.5em;
	height: 500px;
}

#modifyCommentContent {
	width: 635.328px;
	height: 36px;
}

#modifySubmitBtn {
}

.modifyAndremoveBtn {
	text-align: right;
}

.bottomBtnBox {
	margin-top: 15px;
}

.bottomBtn {
	background-color: #3498db;
	color: #ffffff;
	width: 100px;
}

.commentFormBox {
	margin-top: 20px;
	margin-bottom: 20px;
}

.commentBox {
	border: 1px solid #ccc;
	width: 1000px;
	margin: 0 auto;
	border-radius: 0.3em;
}

.commentBox div {
	height: 36px;
}

#commentContent {
	width: 900px;
}

.commentAddBtn {
	background-color: #ccc;
	width: 100px;
}

.commentBtn {
	background-color: #ccc;
	width: 100%;
	height: 35px;
}

.commentBox .col-1 {
	padding: 1px;
}

.pagination {
	margin-top: 15px;
}

.page-item.active .page-link {
	background-color: #ccc;
	border-color: #ccc;
	color: black;
}
	
.page-link {
	color: black;
}

/* Dropdown container (hidden by default). Optional: add a lighter background color and some left padding to change the design of the dropdown content */
.dropdown-container {
	text-align: center;
	display: none;
	background-color: #3498db;
	padding-left: 8px;
}

/* Optional: Style the caret down icon */
.fa-caret-down {
	float: right;
	padding-right: 8px;
}

@media screen and (max-height: 450px) {
	.sidenav {padding-top: 15px;}
	.sidenav a {font-size: 18px;}
}
</style>
</head>
<body>
<div th:class="container-fluid">
	<div th:include="/include/menu::sidemenu"></div>
	<div th:class="main">
		<div th:class="main-contents">
			<div th:class="title">
				<h1 th:text="'게시판 상세보기'"></h1>
			</div>
			<div th:class="row">
				<div th:class="col"><a th:class="'btn navBtn'" th:href="@{/boardDetail(boardNo=${prevBoardNo})}" th:text="'이전글'" th:if="${board.boardNo}>${firstBoardNo}"></a></div>
				<div th:class="'col nextBtn'"><a th:class="'btn navBtn'" th:href="@{/boardDetail(boardNo=${nextBoardNo})}" th:text="'다음글'" th:if="${board.boardNo}<${lastBoardNo}"></a></div>
			</div>
			<!-- 게시글 -->
			<div th:class="border-div">
				<div th:text="'제목 : ' + ${board.boardTitle}" th:class="'boardBox'"></div>
				<div th:class="'row boardBox'">
					<div th:class="'col'" th:text="'작성자 : ' + ${board.memberId}"></div>
					<div th:class="'col'" th:text="'작성날짜 : ' + ${board.boardDate}"></div>
				</div>
				<div th:class="'boardBox content'">
					<div><img th:src="@{${'/upload/board/' + board.boardPic}}" th:if="${board.boardPic!=null}"></div>
					<div th:text="${board.boardContent}"></div>
				</div>
			</div>
			<!-- 목록, 수정, 삭제 버튼 -->
			<div th:class="'row bottomBtnBox'">
				<div th:class="col"><a th:href="@{/getBoardListByPage}" th:text="'목록'" th:class="'btn bottomBtn'"></a></div>
				<div th:class="'col modifyAndremoveBtn'" th:if="${session.loginMember.memberId} eq ${board.memberId}">
					<a th:href="@{/modifyBoard(boardNo=${board.boardNo})}" th:text="'수정'" th:class="'btn bottomBtn'"></a>
					<a th:href="@{/removeBoard(boardNo=${board.boardNo})}" th:text="'삭제'" th:class="'btn bottomBtn'"></a>
				</div>
			</div>
			<!-- 댓글 입력 폼 -->
			<div class="commentFormBox">
				<form id="commentForm" method="post" th:action="@{/addComment}" class="form-inline">
					<input type="hidden" th:name="memberId" th:value="${session.loginMember.memberId}">
					<input type="hidden" th:name="boardNo" th:value="${board.boardNo}" id="boardNoVal">
					<input type="text" th:name="commentContent" id="commentContent" class="form-control">
					<button class="btn commentAddBtn" id="commentAddBtn" type="button">댓글입력</button>
				</form>
			</div>
			<!-- 댓글 리스트 -->
			<div>
				<div class="row commentBox" th:each="comment, index : ${commentList}">
					<div th:text="${comment.commentNo}" style="display: none" th:id="'commentNoText'+${index.index}"></div>
					<div class="col-2" th:text="${comment.memberId}"></div>
					<div class="col-8" th:text="${comment.commentContent}" th:id="'commentContentText'+${index.index}"></div>
					<div class="col-1" th:id="'modify-div'+${index.index}"><a th:if="${session.loginMember.memberId} == ${comment.memberId}" th:text="'수정'" class="btn commentBtn" th:id="'modifyBtn'+${index.index}"></a></div>
					<div class="col-1"><a th:if="${session.loginMember.memberId} == ${comment.memberId}" th:href="@{/removeComment(commentNo=${comment.commentNo}, boardNo=${comment.boardNo})}" th:text="'삭제'" class="btn commentBtn"></a></div>
				</div>
			</div>			
			<!-- 댓글 페이징 -->
			<ul class="pagination"  style="justify-content: center;">
				<li class="page-item"><a th:href="@{/boardDetail(boardNo=${board.boardNo}, currentPage=${page.currentPageGroup-page.pagePerGroup})}" th:if="${page.currentPageGroup}>1" class="page-link"><i class="fa fa-angle-left"></i></a></li>
				<li th:if="${i}<${page.lastPage+1}" th:each="i : ${#numbers.sequence(page.currentPageGroup, page.currentPageGroup+page.pagePerGroup-1)}" th:class="${i}==${page.currentPage} ? 'page-item active' : 'page-item'">
					<span th:if="${i}==${page.currentPage}" th:text="${i}" class="page-link"></span>
					<a th:unless="${i}==${page.currentPage}" th:text=${i} th:href="@{/boardDetail(boardNo=${board.boardNo}, currentPage=${i})}" class="page-link"></a>
				</li>
				<li class="page-item"><a href="@{/boarDetail(boardNo=${board.boardNo}, currentPage=${page.currentPageGroup+page.pagePerGroup})}" th:if="${page.currentPageGroup<(page.lastPageGroup-1)*page.pagePerGroup+1}" class="page-link"><i class="fa fa-angle-right"></i></a></li>
			</ul>
		</div>
	</div>
</div>
</body>
</html>